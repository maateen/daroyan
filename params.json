{
  "name": "Daroyan",
  "tagline": "Daroyan is a modern utility tool which integrates CloudFlare with Fail2Ban.",
  "body": "# Daroyan\r\n\r\nDaroyan is a modern utility tool which integrates CloudFlare with Fail2Ban. It is written in Python3 and use MySQL/MariaDB as database. \r\n\r\nFail2Ban can monitor every hit over NginX web server from NginX `access.log`. By parsing this log file, we can detect which IP is launching DDOS attack to the server. If you are using CloudFlare, you can block these IP at Web Application Firewall level. Thus CloudFlare will stop these hit before reaching at your server. Daroyan used to do this job.\r\n\r\nThe name 'Daroyan' has been derived from Bengali dictionary, which means 'Gatekeeper' in English.\r\n\r\n# Requirements\r\n\r\n- python3\r\n- python3-pip\r\n- mysql-client\r\n- mysql-server\r\n- fail2ban\r\n- unzip\r\n\r\n# Installation\r\n\r\nFor **Ubuntu 16.04 LTS**, we need to run the following command on terminal to install all requirements:\r\n\r\n```\r\nsudo apt-get install python3 python3-pip mysql-client mysql-server fail2ban unzip\r\n```\r\n\r\nNow we will install Daroyan. Please run these commands on terminal:\r\n\r\n```\r\nwget https://github.com/maateen/daroyan/archive/master.zip\r\n```\r\n```\r\nunzip master.zip\r\n```\r\n```\r\nmv daroyan-master /etc/daroyan\r\n```\r\n```\r\nsudo pip3 install -r /etc/daroyan/requirements.txt\r\n```\r\n\r\nSo Daroyan has been installed in **/etc/daroyan** directory.\r\n\r\n# Configuration\r\n\r\nAt first, we will configure our Fail2Ban. Please, open `jail.local` with this command:\r\n\r\n```\r\nnano /etc/fail2ban/jail.local\r\n```\r\n\r\nLet's add these section in it:\r\n\r\n```\r\n[fail2ban-daroyan]\r\nenabled  = true\r\nfilter   = nginx-ddos\r\naction   = daroyan\r\nlogpath  = /var/log/nginx/access.log\r\nmaxretry = 5\r\nfindtime = 60\r\nbantime  = 604800\r\n```\r\n\r\nNow run the following command on terminal:\r\n\r\n```\r\nnano /etc/fail2ban/action.d/daroyan.conf\r\n```\r\n\r\nPaste the following lines in it:\r\n\r\n```\r\n# Fail2Ban configuration file for Daroyan integration\r\n\r\n[Definition]\r\n\r\n# Option:  actionstart\r\n# Notes.:  command executed once at the start of Fail2Ban.\r\n# Values:  CMD\r\n#\r\nactionstart = touch /var/log/daroyan/fail2ban.log\r\n\r\n# Option:  actionstop\r\n# Notes.:  command executed once at the end of Fail2Ban\r\n# Values:  CMD\r\n#\r\nactionstop = \r\n\r\n# Option:  actioncheck\r\n# Notes.:  command executed once before each actionban command\r\n# Values:  CMD\r\n#\r\nactioncheck = \r\n\r\n# Option:  actionban\r\n# Notes.:  command executed when banning an IP. Take care that the\r\n#          command is executed with Fail2Ban user rights.\r\n# Tags:    See jail.conf(5) man page\r\n# Values:  CMD\r\n#\r\nactionban = printf \"<ip>\\n\" >> /var/log/daroyan/fail2ban.log\r\n\r\n# Option:  actionunban\r\n# Notes.:  command executed when unbanning an IP. Take care that the\r\n#          command is executed with Fail2Ban user rights.\r\n# Tags:    See jail.conf(5) man page\r\n# Values:  CMD\r\n#\r\nactionunban = \r\n\r\n[Init]\r\n```\r\n\r\nNow run the following command on the terminal:\r\n\r\n```\r\nnano /etc/fail2ban/filter.d/fail2ban-daroyan.conf\r\n```\r\n\r\nPaste the following lines in it:\r\n\r\n```\r\n[Definition]\r\n \r\n# Option:  failregex\r\n#          host must be matched by a group named \"host\". The tag \"<HOST>\" can\r\n#          be used for standard IP/hostname matching and is only an alias for\r\n#          (?:::f{4,6}:)?(?P<host>\\S+)\r\n# Values:  TEXT\r\n#\r\nfailregex = ^<HOST> -*\r\n \r\n# Option:  ignoreregex\r\n# Notes.:  regex to ignore. If this regex matches, the line is ignored.\r\n# Values:  TEXT\r\n#\r\nignoreregex =\r\n```\r\n\r\nFail2Ban has been configured. Now we have to configure Daroyan. Open its `config.py` with following command:\r\n\r\n```\r\nnano /etc/daroyan/config.py\r\n```\r\n\r\nPlease create a MySQL database and user. Then set them properly in `config.py`. \r\n\r\nNow we will use Upstart to ensure that Daroyan runs automatically every time the server is booted or rebooted. So, please run the following command on terminal:\r\n\r\n```\r\nnano /etc/init/daroyan.conf\r\n```\r\n\r\nPaste the following lines in it:\r\n\r\n```bash\r\nstart on runlevel [2345]\r\nstop on runlevel [016]\r\n \r\nrespawn\r\n \r\nscript\r\n    python3 /etc/daroyan/daroyan.py\r\nend script\r\n```\r\n\r\nNow run daroyan with following command:\r\n\r\n```\r\nsudo service daroyan start\r\n```\r\n\r\nThat's all. ",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}